<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Infection of Human Immunodeficiency Virus (HIV) & Acquired Immunodeficiency Syndrome (AIDS) between Gender</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        html, body {
            height: 100%; /* Ensure the body takes up full height */
            margin: 0; /* Remove default margin */
        }

        body {
            display: flex; /* Use flexbox for layout */
            flex-direction: column; /* Stack children vertically */
        }

        header, footer {
            background-color: #16A085;
            color: #fff;
            text-align: center;
            padding: 1em;
        }

        main {
            flex: 1;
            padding: 40px;
            text-align: justify;
            background-color: #FDFEFE;
        }

        .navigation {
    background-color: #444; 
    display: flex; 
    padding: 3px; 
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); 
}

.navigation a {
    color: #fff;
    text-decoration: none; 
    padding: 1em 1.5em; 
    position: relative; 
    transition: background-color 0.3s, color 0.3s; 
    border-radius: 5px;
}

.navigation a:hover {
    background-color: #555; 
}

.dropdown {
    position: relative;
    margin-top: 15px;
}

.dropdown-content {
    display: none;
    position: absolute; 
    margin-top: 15px; 
    background-color: #444; 
    min-width: 300px; 
    z-index: 1; 
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); 
}

.dropdown-content a {
    color: white; 
    padding: 12px 16px; 
    text-decoration: none; 
    display: block; 
    transition: background-color 0.3s; 
}

.dropdown:hover .dropdown-content {
    display: block; 
}

.dropdown-content a:hover {
    background-color: #555; 
}

        .button-container {
            text-align: center;
            margin-bottom: 20px;
        }

        button {
            margin: 10px;
            padding: 12px 20px;
            background-color: #fff;
            color: #16A085;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #16A085;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        button:hover {
            background-color: #16A085;
            color: white;
        }

        button.active {
            background-color: #16A085;
            color: white;
            transform: scale(1.1);
        }

        #chart {
            width: 400px;
            height: 400px;
            margin: 20px auto;
        }

        .legend {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .legend div {
            margin-right: 20px;
            display: flex;
            align-items: center;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }

        .year-description-box {
            display: none; /* Initially hide all year description boxes */
            background-color: #f4f4f4;
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            text-align: center;
        }

        #year-label {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        footer {
            background-color: #16A085;
            color: #fff;
            text-align: center;
            padding: 5px;
            position: relative;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
<body>

<header>
    <h1>Analysis Infection of Human Immunodeficiency Virus (HIV) </h1>
    <h1>& Acquired Immunodeficiency Syndrome (AIDS) between Gender</h1>
</header>

<!-- Navigation Menu -->
<nav class="navigation">
    <a href="../index.html">Home</a>
    <div class="dropdown">
        <a href="">Statistic</a>
        <div class="dropdown-content">
            <a href="../DV1/DV1.html">Sexually Transmitted Infections(STI) Analysis: A Yearly Overview</a>
            <a href="../DV2/DV2.html">Data 2</a>
            <a href="DV3.html">Rate of AIDS cases (per 100,000 cases) in Europe between 2017 to 2021</a>
            <a href="#data4">Analysis Infection of Human Immunodeficiency Virus (HIV) & Acquired Immunodeficiency Syndrome (AIDS) between Gender</a>
            <a href="#data5">Data 5</a>
        </div>
    </div>
    <a href="../about.html">About Us</a>
</nav>

<main>
    <h2>Overview</h2>
    <p>Testing 123</p>
</main>

<div class="button-container">
    <button id="button2017" onclick="updateChart(2017)">2017</button>
    <button id="button2018" onclick="updateChart(2018)">2018</button>
    <button id="button2019" onclick="updateChart(2019)">2019</button>
    <button id="button2020" onclick="updateChart(2020)">2020</button>
    <button id="button2021" onclick="updateChart(2021)">2021</button>
</div>

<!-- Year Label (to be updated dynamically) -->
<div id="year-label">Rate of HIV & AIDS Infection in 2017 between Male and Female</div>

<div id="chart"></div>

<!-- Legend Box -->
<div class="legend">
    <div>
        <div class="legend-color" style="background-color: #1E90FF;"></div>
        <span>Male</span>
    </div>
    <div>
        <div class="legend-color" style="background-color: #FF6347;"></div>
        <span>Female</span>
    </div>
</div>

<!-- Year Description Boxes -->
<div class="year-info">
    <div id="description2017" class="year-description-box">
        <h2>2017</h2>
        <p>Description of data for 2017 will be displayed here.</p>
    </div>
    <div id="description2018" class="year-description-box">
        <h2>2018</h2>
        <p>Description of data for 2018 will be displayed here.</p>
    </div>
    <div id="description2019" class="year-description-box">
        <h2>2019</h2>
        <p>Description of data for 2019 will be displayed here.</p>
    </div>
    <div id="description2020" class="year-description-box">
        <h2>2020</h2>
        <p>Description of data for 2020 will be displayed here.</p>
    </div>
    <div id="description2021" class="year-description-box">
        <h2>2021</h2>
        <p>Description of data for 2021 will be displayed here.</p>
    </div>
</div>

<script>
    // Set up the dimensions of the pie chart
    const width = 400;
    const height = 400;
    const radius = Math.min(width, height) / 2;
    const color = d3.scaleOrdinal()
        .domain(["Male", "Female"])
        .range(["#1E90FF", "#FF6347"]); // Male = blue, Female = red

    // Create the SVG container
    const svg = d3.select("#chart")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g")
        .attr("transform", `translate(${width / 2}, ${height / 2})`);

    // Create the pie chart layout
    const pie = d3.pie()
        .value(d => d.TotalValue)
        .sort(null); // Don't sort by default

    // Create the arc path generator
    const arc = d3.arc()
        .outerRadius(radius - 10)
        .innerRadius(0);

    // Function to create the pie chart
    function createPieChart(data) {
        const totalValue = d3.sum(data, d => d.TotalValue);

        // Set the chart data
        const arcData = pie(data);

        // Bind the data to the paths
        const paths = svg.selectAll(".arc")
            .data(arcData);

        // Remove any exiting paths (if there's any)
        paths.exit()
            .transition()
            .duration(750)
            .attrTween("d", arcTweenExit)
            .remove();

        // Update the existing paths with new data
        paths.transition()
            .duration(750)
            .attrTween("d", arcTween);

        // Add new slices if there are any
        paths.enter()
            .append("path")
            .attr("class", "arc")
            .attr("fill", d => color(d.data.Gender))
            .attr("d", arc)
            .each(function(d) { this._current = d; }) // Store initial angles
            .transition()
            .duration(750)
            .attrTween("d", arcTween);

        // Add the labels (percentage + TotalValue) inside the slices
        const labels = svg.selectAll(".label")
            .data(arcData);

        // Update the existing labels
        labels.transition()
            .duration(750)
            .attr("transform", d => "translate(" + arc.centroid(d) + ")")
            .text(d => {
                const percentage = ((d.data.TotalValue / totalValue) * 100).toFixed(1);
                return `${percentage}%`;
            });

        // Add new labels
        labels.enter()
            .append("text")
            .attr("class", "label")
            .attr("transform", d => "translate(" + arc.centroid(d) + ")")
            .attr("text-anchor", "middle")
            .attr("font-size", "20px")
            .attr("fill", "#fff")
            .text(d => {
                const percentage = ((d.data.TotalValue / totalValue) * 100).toFixed(1);
                return `${percentage}%`;
            });
    }

    // Load the CSV data
    d3.csv("PieChart.csv").then(function(data) {
        // Parse the data: convert "TotalValue" to numbers
        data.forEach(d => {
            d.TotalValue = +d.TotalValue; // Ensure TotalValue is numeric
        });

        // Group data by year
        const groupedData = d3.groups(data, d => d.Year);

        // Initialize with 2017 data
        const initialData = groupedData.find(d => d[0] == 2017)[1];
        createPieChart(initialData);

        // Function to update the pie chart and descriptions based on the selected year
        window.updateChart = function(year) {
            // Update the active button style
            const buttons = document.querySelectorAll("button");
            buttons.forEach(button => button.classList.remove("active"));
            document.getElementById("button" + year).classList.add("active");

            const yearData = groupedData.find(d => d[0] == year)[1];
            createPieChart(yearData);

            // Update the year label above the pie chart
            document.getElementById("year-label").innerText = `Rate of HIV & AIDS Infection in ${year} between Male and Female`;

            // Hide all description boxes
            const allDescriptionBoxes = document.querySelectorAll(".year-description-box");
            allDescriptionBoxes.forEach(box => box.style.display = "none");

            // Show the description box for the selected year
            document.getElementById("description" + year).style.display = "block";
        };

        // Call the function to show 2017 chart and description by default
        updateChart(2017);  // This will trigger the default view to show 2017's pie chart and description

        // Initialize the 2017 button as active
        document.getElementById("button2017").classList.add("active");
    }).catch(function(error) {
        console.error('Error loading the CSV file:', error);
    });

    // Arc transition function for entering and updating
    function arcTween(a) {
        const i = d3.interpolate(this._current, a); // Interpolate the current arc to the new arc
        this._current = i(0); // Store the new current arc
        return function(t) {
            return arc(i(t)); // Return the path at the interpolated point
        };
    }

    // Arc transition function for exiting
    function arcTweenExit(a) {
        const i = d3.interpolate(this._current, a); // Interpolate for exit transition
        return function(t) {
            return arc(i(t)); // Return the path at the interpolated point
        };
    }
</script>

<footer>
    <p>&copy; 2024 Data Visualization Project Group 4</p>
</footer>

</body>
</html>
